<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="https://cdn-icons.flaticon.com/png/512/3041/premium/3041070.png?token=exp=1634464322~hmac=51f588d32f9cbfaece550911ef66a7e2"/>
  <!-- <div>Icons made by <a href="https://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div> -->

  <title>Japana-Esperanto Vortaro</title>


  <!--
  Dark and Light Themes
  -->
  <script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // In this case, light.css will be downloaded with `highest` priority.
  if (window.matchMedia('(prefers-color-scheme: dark)').media === 'not all') {
      document.documentElement.style.display = 'none';
      document.head.insertAdjacentHTML(
          'beforeend',
          '<link rel="stylesheet" href="style/light.css" onload="document.documentElement.style.display = \'\'">'
      );
  }
  </script>
  <!--
  for mobile web browser
  -->
  <script type="text/javascript">
    // @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&dn=gpl-2.0.txt GPL-v2
    if (navigator.userAgent.indexOf("Mobile") !== -1) {
      window.location.href = "mobile.html";
    }
    // @license-end
  </script>

  <link rel="stylesheet" href="style/dark.css" media="(prefers-color-scheme: dark)">
  <link rel="stylesheet" href="style/light.css" media="(prefers-color-scheme: no-preference), (prefers-color-scheme: light)">
  <link rel="stylesheet" href="style/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@200&display=swap" rel="stylesheet">


</head>

<body value="en" onload =getDictionary(this)>

  <header>
    <h1>Japana-Esperanto Vortaro</h1>

    <!--button value="en" onclick="getDictionary(this)">English</button>-->
  </header>

  <br><hr>

  <div id="data" style="overflow-x:auto;">
    <div id="search"></div>
    <div id="parsed_csv_list"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jets/0.14.1/jets.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>
  <script>
    var currentDictionary = '';
    if (window.location.search.length > 2) {
      currentDictionary = window.location.search.slice(3);
      console.log('current dictionary:' + currentDictionary)
      getDictionary(currentDictionary);
    } else {
      console.log('no dictionary found in url.')
    }



    function getDictionary(element) {
      console.log(element);

      var languageISO;

      if (typeof element == 'string') {
        languageISO = element;
      } else {
        languageISO = element.value;
      }

      //history.pushState({dictionary:languageISO},'','?d=' + languageISO);
      currentDictionary = languageISO;

      var searchPlaceholder = '';
      switch (languageISO) {
        case 'en':
          searchPlaceholder = "serĉi";
          break;
        default:
          searchPlaceholder = "serĉi";
      }

      console.log(languageISO);
      //var csvURL = "data/" + languageISO + "-ie.csv";
      //var csvURL = "data/en-ie.csv";
      var csvURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSIvSpWZ5MVfiSx5bFgcoCoPk23sNEEL4rGt3x9eiZ3yv1h1heeT5W5Z_mFULjKfUENCzj4q55p6U95/pub?output=csv";

      $("#parsed_csv_list").empty();
      $("#search").empty();
      $("#search").html("<input id='targetLang_search' placeholder=" + searchPlaceholder + " type='search'>");

      Papa.parse(csvURL, {
        download: true,
        header: false,
        //worker: true,
        //step: function(row) {
        //  console.log("Row:", row.data);
        //},
        complete: displayHTMLTable
      });
    }

    function displayHTMLTable(results){
      var table = "<table class='table'><thead><tr>";
      var data = results.data;
      var header = data.shift();
      for(h=0;h<header.length;h++){
        table+= "<th>" + header[h] + "</th>";
      }
      table+= "</tr></thead><tbody id='jetsContent'>";

      for(i=0;i<data.length;i++){
        table+= "<tr>";
        var row = data[i];
        for(j=0;j<row.length;j++){
          var cell = row[j];
          table+= "<td>" + cell + "</td>";
        }
        table+= "</tr>";
      }
      table+= "</tbody></table>";
      $("#parsed_csv_list").html(table);
      var jets = new Jets({
        contentTag: '#jetsContent',
        searchInSpecificColumn: true,
        callSearchManually: true,
        columns: [0,1],
        diacriticsMap: {
          a: "ÁÀÃÂÄáàãâäāǎ",
          я: "я́",
          e: "ÉÈÊËéèêëēě",
          i: "ÍÌÎÏíìîïīǐ",
          o: "ÓÒÕÔÖóòõôöōǒ",
          u: "ÚÙÛÜúùûŭüū",
          c: "ĉ",
          g: "ĝ",
          h: "ĥ",
          j: "ĵ",
          s: "ŝ",
        }
      });
      $("#targetLang_search").on("input", function(event) { jets.search(event.target.value, [0][1]) } );
    }
  </script>
 </body>

</html>
